<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>aux-chapter-building-companion</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="AUX-Chapter-Building-Companion_files/libs/clipboard/clipboard.min.js"></script>
<script src="AUX-Chapter-Building-Companion_files/libs/quarto-html/quarto.js"></script>
<script src="AUX-Chapter-Building-Companion_files/libs/quarto-html/popper.min.js"></script>
<script src="AUX-Chapter-Building-Companion_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AUX-Chapter-Building-Companion_files/libs/quarto-html/anchor.min.js"></script>
<link href="AUX-Chapter-Building-Companion_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AUX-Chapter-Building-Companion_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AUX-Chapter-Building-Companion_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AUX-Chapter-Building-Companion_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AUX-Chapter-Building-Companion_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="chapter-building-companion" class="level1">
<h1>Chapter building companion</h1>
<section id="quick-time-line" class="level2">
<h2 class="anchored" data-anchor-id="quick-time-line">Quick time line</h2>
<ul>
<li>took over oct 2021</li>
<li>start ref: January 2022</li>
<li>started a structured quarto book: june 2022</li>
<li>june 2023: ? obj newsletter june 16th</li>
</ul>
</section>
<section id="mind-management-insights" class="level2">
<h2 class="anchored" data-anchor-id="mind-management-insights">Mind management insights</h2>
<ul>
<li>starting the day with editing previous work ?! tto long ?</li>
</ul>
<section id="hf-pb-create-two-chapters" class="level3">
<h3 class="anchored" data-anchor-id="hf-pb-create-two-chapters">HF pb create two chapters</h3>
<ul>
<li><p>methods</p></li>
<li><p>practical methods</p></li>
</ul>
</section>
<section id="what-you-will-find-in-this-chapter" class="level3">
<h3 class="anchored" data-anchor-id="what-you-will-find-in-this-chapter">What you will find in this chapter</h3>
<p>(force this format even if provisional) What could be useful here ? In which cases look further here ? Links to other chapters Q&amp;A format</p>
</section>
</section>
<section id="tables-development" class="level2">
<h2 class="anchored" data-anchor-id="tables-development">Tables development</h2>
<ul>
<li><p>synthetic vision</p></li>
<li><p>Tab1: frequencies (TS) by algo by (R ro GUI)</p></li>
</ul>
</section>
<section id="methodo-questions" class="level2">
<h2 class="anchored" data-anchor-id="methodo-questions">Methodo questions</h2>
<p>starting with old chapters</p>
<ul>
<li>spectral</li>
<li>tests</li>
<li>seats</li>
</ul>
</section>
<section id="new-pbs" class="level2">
<h2 class="anchored" data-anchor-id="new-pbs">NEW pbs</h2>
<ul>
<li><p>specify scope: example cruncher doesn’t work with stl: obvious ?</p></li>
<li><p>are revision policies available for HF data ?</p></li>
<li><p>can we generate calendar regressors for weekly data</p></li>
<li><p>specify (+ more variety in examples) for which data frequency a function is available</p></li>
</ul>
</section>
<section id="add-to-each-chapter" class="level2">
<h2 class="anchored" data-anchor-id="add-to-each-chapter">ADD (to each chapter)</h2>
<ul>
<li><p>scope by data type</p></li>
<li><p>contrast differences R vs GUI</p></li>
</ul>
<section id="harmonization-of-names" class="level3">
<h3 class="anchored" data-anchor-id="harmonization-of-names">Harmonization of names</h3>
<ul>
<li>revision policies: fixed autoregressive parameters</li>
</ul>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>…and time line for loop 1 (= showable)</p>
<ul>
<li>1 R packages (loop 1 ok : 29/05 next loop 2…)</li>
</ul>
<p>lacks for 2nd loop: cf chapter’s details</p>
<ul>
<li><p>1 Rev policies: easy</p></li>
<li><p>1b production cruncher (loop 1: 30/05, loop 2: cf below )</p></li>
<li><p>2 HF with GUI (includes testing)</p></li>
<li><p>polish HF</p></li>
<li><p>outliers</p></li>
<li><p>3 GUI ?: tough as maj all links.. maybe much less description and more links (video for v3) keep a copy of this chapter in AUX and completely refactor it ?</p></li>
<li><p>calendar chap + vignette</p></li>
<li><p>outliers chap + vignette</p></li>
<li><p>SA chap: finish up + vignette</p>
<ul>
<li>enhance R code</li>
<li>add and test rdj3 code (aux file rjd3_tests_for_doc.R in 00_rjd3_dev repo/Code R) obj : set up a system for efficient OTG testing</li>
<li>finish up seats part</li>
</ul></li>
<li><p>sA HF with KW</p></li>
</ul>
<p>Above = essentials (loop 1 spirit) Below: just brush up optional</p>
<ul>
<li><p>idea= maximum brush up clean up and structure setting (always easier to fill in than to start from scratch)</p></li>
<li><p>STL with KW</p></li>
</ul>
<section id="chunks-for-mind-management" class="level3">
<h3 class="anchored" data-anchor-id="chunks-for-mind-management">Chunks for mind management</h3>
<section id="structure" class="level4">
<h4 class="anchored" data-anchor-id="structure">Structure</h4>
<p>next</p>
</section>
</section>
<section id="writing-filling-in-easy-no-editing" class="level3">
<h3 class="anchored" data-anchor-id="writing-filling-in-easy-no-editing">Writing, filling in (easy, no editing)</h3>
<ul>
<li><p>R version 3 chunks in SA chapter</p></li>
<li><p>outlier detection functions in rjd3x13 and tramoseats (quick)</p></li>
</ul>
</section>
<section id="filling-in-small-gaps-20-time-slots-ok" class="level3">
<h3 class="anchored" data-anchor-id="filling-in-small-gaps-20-time-slots-ok">Filling in small gaps (20’ time slots ok)</h3>
<section id="editing-and-testing" class="level4">
<h4 class="anchored" data-anchor-id="editing-and-testing">Editing and testing</h4>
<p>For all menu, graphical references:</p>
<ul>
<li><p>check validity in version 3 (step1) change if necessary</p></li>
<li><p>update visuals (screen shots to version 3), not urgent if no functional incidence</p></li>
</ul>
<p>apply in</p>
<p>-T plug-ins chapter</p>
</section>
</section>
<section id="finishing-up" class="level3">
<h3 class="anchored" data-anchor-id="finishing-up">Finishing up</h3>
<p>low hanging fruit</p>
</section>
</section>
<section id="journal" class="level2">
<h2 class="anchored" data-anchor-id="journal">Journal</h2>
</section>
<section id="technical-choices" class="level2">
<h2 class="anchored" data-anchor-id="technical-choices">Technical choices</h2>
<ul>
<li>links to R packages doc and vignettes</li>
</ul>
</section>
<section id="principles" class="level2">
<h2 class="anchored" data-anchor-id="principles">Principles</h2>
<p>policy: - what is displayed in GUI should be explained, even if shortly, adding links to relevant method chapter from GUI: all panels have to be described</p>
<ul>
<li>the same does not apply to R packages as they have a documentation on their own any output any param setting possibility</li>
</ul>
</section>
<section id="difference-with-training" class="level2">
<h2 class="anchored" data-anchor-id="difference-with-training">Difference with training</h2>
<ul>
<li>rationale for params</li>
<li>diagnostics</li>
<li>what can be changed, but not why !</li>
</ul>
</section>
<section id="template-for-algo-parts-description" class="level2">
<h2 class="anchored" data-anchor-id="template-for-algo-parts-description">Template for algo (parts) description</h2>
<p>default params (quick launch) INPUT (?) Output1: series Output2: Final Params Output3: Diagnostics User-defined parameters</p>
</section>
<section id="overview-at-the-beginning-of-each-chapter" class="level2">
<h2 class="anchored" data-anchor-id="overview-at-the-beginning-of-each-chapter">Overview at the beginning of each chapter</h2>
<p>SIMILAR Head of chapter and structure (allowing to easily move around)</p>
<section id="split-info-into-3-categories" class="level3">
<h3 class="anchored" data-anchor-id="split-info-into-3-categories">Split info into 3 categories</h3>
</section>
</section>
<section id="preface-starting-chapter-by-chapter-notes" class="level2">
<h2 class="anchored" data-anchor-id="preface-starting-chapter-by-chapter-notes">Preface (Starting chapter by chapter notes)</h2>
</section>
<section id="g-what-is-jd.qmd" class="level2">
<h2 class="anchored" data-anchor-id="g-what-is-jd.qmd">G-what-is-jd.qmd</h2>
<p>resources for description can be widely used</p>
<ul>
<li><p>R tools Doc</p></li>
<li><p>JD+ esp pdf</p></li>
</ul>
</section>
<section id="g-jd-history.qmd" class="level2">
<h2 class="anchored" data-anchor-id="g-jd-history.qmd">G-jd-history.qmd</h2>
<p>to be organized</p>
<p>resources - small publi 4p insee/eurostat</p>
<p>web explo stack</p>
</section>
<section id="a-sa.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-sa.qmd">A-sa.qmd</h2>
<section id="any-table-display" class="level3">
<h3 class="anchored" data-anchor-id="any-table-display">(Any) table display</h3>
<p>What can be done with this table (expandable note ?)</p>
<ul>
<li>charts container (link) - single series contextual menu (link)</li>
</ul>
</section>
<section id="questions-and-meth-holes" class="level3">
<h3 class="anchored" data-anchor-id="questions-and-meth-holes">questions and meth holes</h3>
<p>Questions:</p>
<ul>
<li><p>allocation to sa: done at the very end ?</p></li>
<li><p>allocated to undefined ?</p></li>
</ul>
</section>
<section id="global-tasks" class="level3">
<h3 class="anchored" data-anchor-id="global-tasks">global tasks</h3>
<ul>
<li>R version 3 code to be added</li>
<li>remove theory related parts</li>
<li>much less text than current doc (too long)</li>
<li>method details: to method chapters</li>
<li>tools details in tools: GUI or R</li>
</ul>
<p>For second release, according to this template rationale: - why and when use this ? - default params (quick launch): some settings ? - INPUT (?) - Output1: series - Output2: Final Params - Output3: Diagnostics - fine tuning User-defined parameters</p>
<p>when describing parameters</p>
<ul>
<li>1 common description</li>
<li>2 setting in GUI</li>
<li>3 setting in R</li>
</ul>
<p>2 categories of work</p>
<ul>
<li><p>missing parts</p></li>
<li><p>parts to revamp or hone</p></li>
</ul>
<p>Steps (loop : structure, flesh out, re-structure…)</p>
<ul>
<li><p>immediate steps</p></li>
<li><p>further steps</p></li>
</ul>
</section>
<section id="add" class="level3">
<h3 class="anchored" data-anchor-id="add">add</h3>
<p>in unobserved components In the Reg-Arima (link) or Tramo(link) modelling the the multiplicative model is estimated in logs; <span class="math inline">\(log(X_{t}) = log(T_{t}) + log(S_{t}) + log(I_{t})\)</span>; Seats decomposition also relies on logs where X-11 decomp operates…</p>
</section>
<section id="ramps-part" class="level3">
<h3 class="anchored" data-anchor-id="ramps-part">ramps part</h3>
<p>test: several</p>
<p>see if here: ? The graph and formula are available in <a href="../theory/SA_lin.html">Linearisation with the TRAMO and RegARIMA models</a>.</p>
<p>explain params - differentiation orders D1DS: if ticked: 1 1 automatically (pb differentiation before the real differentiation ??)</p>
<section id="in-reg-arima-results" class="level4">
<h4 class="anchored" data-anchor-id="in-reg-arima-results">in reg arima results</h4>
<ul>
<li>seasonality tests on residuals (Highlight differences: - in gui - in R v2: retrieve object in output, v3 run test)</li>
</ul>
<section id="allocation-to-components" class="level6">
<h6 class="anchored" data-anchor-id="allocation-to-components">Allocation to components</h6>
<p>allocation when intervention or ramps ? in test allocated to trend ? (reg)</p>
<p>impossible (?) to create several intervention variables</p>
<p>Remaining topics</p>
</section>
</section>
</section>
</section>
<section id="a-sa-hf.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-sa-hf.qmd">A-sa-hf.qmd</h2>
<section id="add-back-and-flesh-out" class="level3">
<h3 class="anchored" data-anchor-id="add-back-and-flesh-out">add back and flesh out</h3>
<section id="in-outlier-detection" class="level4">
<h4 class="anchored" data-anchor-id="in-outlier-detection">In outlier detection</h4>
<p>user defined outliers, variables ?</p>
</section>
<section id="in-calendar" class="level4">
<h4 class="anchored" data-anchor-id="in-calendar">In calendar</h4>
<p>explain problems and mixing with seasonality …</p>
<section id="spectral-analysis" class="level5">
<h5 class="anchored" data-anchor-id="spectral-analysis">Spectral analysis</h5>
</section>
<section id="seasonality-tests" class="level5">
<h5 class="anchored" data-anchor-id="seasonality-tests">Seasonality tests</h5>
</section>
</section>
</section>
</section>
<section id="a-outlier-detection.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-outlier-detection.qmd">A-outlier-detection.qmd</h2>
<p>data type</p>
<p>contrasting GUI and R packages</p>
<p>small chunks on regressors to be added</p>
<p>more info on detection</p>
</section>
<section id="a-calendar-correction.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-calendar-correction.qmd">A-calendar-correction.qmd</h2>
<p>remarks:</p>
<ul>
<li><p>less dense content, less text more tables, bullet points</p></li>
<li><p>check and add documents new v3 features</p></li>
<li><p>cjo frequency explained by K they simulate calendar pattern…empirically fall here (cf refs papers)</p></li>
</ul>
<p>frequency 41 et 41 survival of 1/60 discrete step in X12 (cf sokup findley)</p>
<section id="to-do" class="level3">
<h3 class="anchored" data-anchor-id="to-do">To do</h3>
<p>On theory part:</p>
<ul>
<li><p>manque effet de paques (cf regressor and ICA: hole)</p></li>
<li><p>length of period</p></li>
<li><p>stock</p></li>
</ul>
<p>On practical part:</p>
<ul>
<li><p>HF in GUI ?</p></li>
<li><p>add in R</p></li>
<li><p>generating regressors from customized calendar : GUI and R</p></li>
<li><p>Length of Period</p></li>
</ul>
<p>adjust param</p>
<ul>
<li>stcok series</li>
</ul>
<p>cf book x12 and SH</p>
<p>The regressor will have the value -1 if the w-th day is a Sunday, 1 if it is a Monday as 0 otherwise.</p>
<p>example lacking in the package</p>
</section>
</section>
<section id="a-benchmarking.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-benchmarking.qmd">A-benchmarking.qmd</h2>
<p>clean up</p>
<p>add rjd3 bench and link help pages</p>
<p>resources</p>
<ul>
<li><p>corentin, beamer rome</p></li>
<li><p>maria, ine, beamer ocde</p></li>
</ul>
</section>
<section id="a-trend-cycle-estimation.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-trend-cycle-estimation.qmd">A-trend-cycle-estimation.qmd</h2>
<p>see alain</p>
<p>see karsten paper on HF</p>
</section>
<section id="a-nowcasting.qmd" class="level2">
<h2 class="anchored" data-anchor-id="a-nowcasting.qmd">A-nowcasting.qmd</h2>
</section>
<section id="t-graphical-user-interface.qmd" class="level2">
<h2 class="anchored" data-anchor-id="t-graphical-user-interface.qmd">T-graphical-user-interface.qmd</h2>
<p>why use the graphical user interface ? what is not directly available in R yet?</p>
<p>objective: describe the general features (independent of algorithms)</p>
<ul>
<li><p>general layout</p></li>
<li><p>options !: like stats tools/ modifs good bad / look and feel</p></li>
<li><p>import data</p></li>
<li><p>documents</p></li>
<li><p>workspaces</p></li>
<li><p>specifications</p></li>
<li><p>output</p></li>
</ul>
<section id="add-1" class="level3">
<h3 class="anchored" data-anchor-id="add-1">Add</h3>
<section id="list-of-output-items" class="level4">
<h4 class="anchored" data-anchor-id="list-of-output-items">List of Output items</h4>
</section>
</section>
</section>
<section id="t-production-tools-cruncher-qr.qmd" class="level2">
<h2 class="anchored" data-anchor-id="t-production-tools-cruncher-qr.qmd">T-Production-tools-cruncher-QR.qmd</h2>
<p>add - List of exportable series (tramo / x13 with names)</p>
<ul>
<li>link to option change for adjusting “good”, “bad”…</li>
</ul>
</section>
<section id="t-r-packages.qmd" class="level2">
<h2 class="anchored" data-anchor-id="t-r-packages.qmd">T-r-packages.qmd</h2>
<ul>
<li><p>add a global descpription of rjd3toolkit cf aux txt file</p></li>
<li><p>include details in rjdemetra3 (when ready)</p></li>
</ul>
</section>
<section id="t-plug-ins.qmd" class="level2">
<h2 class="anchored" data-anchor-id="t-plug-ins.qmd">T-plug-ins.qmd</h2>
<p>ok for now, visuals to be checked</p>
</section>
<section id="t-rev-policies-production.qmd" class="level2">
<h2 class="anchored" data-anchor-id="t-rev-policies-production.qmd">T-rev-policies-production.qmd</h2>
<p>add - v3 visuals (progressive) - fixed auto reg param - inter chapter links : r packs, cruncher</p>
<p>obj here: general explanations + examples ? here : explain voc discrepancies vs guidelines bbk controlled current link to plug in illustration links on covid</p>
<section id="revision-policies" class="level4">
<h4 class="anchored" data-anchor-id="revision-policies">Revision Policies</h4>
<p>general concepts - identified vs estimated - linearization phase - X11 - seats</p>
<p>here concepts of domain spec, point spec</p>
<p>concurrent = first estimation or redo everything (never overrides user defined parameters)</p>
</section>
</section>
<section id="implemententing-revision-policies-in-r" class="level2">
<h2 class="anchored" data-anchor-id="implemententing-revision-policies-in-r">Implemententing revision policies in R</h2>
</section>
<section id="m-spectral-analysis.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-spectral-analysis.qmd">M-spectral-analysis.qmd</h2>
<p>add: - R code or references to - rjd3sa (?) references to tests - more explanations on spectral analysis rationale</p>
<p>Vocabulary precision and concise definitions - spectral density - periodogram - spectral density estimator - “spectrum” is used too ubiquitously</p>
</section>
<section id="m-reg-arima-modelling.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-reg-arima-modelling.qmd">M-reg-arima-modelling.qmd</h2>
<p>In the chapter on SA, in the pre-adjustment section, we tackle: - purpose, principles and results of reg-arima models (tramo or reg-arima)</p>
<p>Here we tackle : - more in depth presentation - details on model estimation (not your typical box and Jenkins)</p>
</section>
<section id="m-x11-decomposition.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-x11-decomposition.qmd">M-X11-decomposition.qmd</h2>
<ul>
<li>add more computation details ?</li>
</ul>
<p>Edit content goal of the chapter: details on X-11 which won’t be in the SA chapter</p>
<p>see - my notes on X-11 - formulas from training yc estp - formulas from HF paper or beamer</p>
</section>
<section id="m-stl-decomposition.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-stl-decomposition.qmd">M-STL-decomposition.qmd</h2>
<p>goal of the chapter : details on STL which are not in the SA chapter</p>
<p>res: - papier HF - papier Daniel on dsa</p>
</section>
<section id="m-seats-decomposition.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-seats-decomposition.qmd">M-SEATS-decomposition.qmd</h2>
</section>
<section id="m-trend-estimation-local-polynomials.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-trend-estimation-local-polynomials.qmd">M-Trend-Estimation-Local-Polynomials.qmd</h2>
</section>
<section id="m-tests.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-tests.qmd">M-tests.qmd</h2>
<p>check NBB aux doc for any missing formulas</p>
</section>
<section id="m-state-space-framework.qmd" class="level2">
<h2 class="anchored" data-anchor-id="m-state-space-framework.qmd">M-state-space-framework.qmd</h2>
<p>beamer - dms moi - koopman</p>
<p>books - durbin - shumway stoffer</p>
<p>edit - change notations to shumway style</p>
</section>
<section id="references.qmd" class="level2">
<h2 class="anchored" data-anchor-id="references.qmd">references.qmd</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>