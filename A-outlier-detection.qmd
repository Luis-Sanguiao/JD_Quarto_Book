# Outlier detection and external regressors {.unnumbered}


## Chapter's overview

The chapter describes 

- how to easily generate useful external regressors for improving seasonal adjustment

- JDemetra+ solutions for outlier detection and in a time series.  
These routines can be used stand alone or as part of a seasonal adjustment process. They can be accessed via GUI or R packages.

How to use the generated regressors in a seasonal adjustment or reg-arima modelling process is discussed in the relevant chapters on [SA](A-sa.qmd) and [SA of High-frequency data](A-sa-hf.qmd). There you will also find out how to fix the corresponding coefficients and how to allocate the effects to selected component.

The external regressors described below are not meant for calendar correction which is detailed [here](A-calendar-correction.qmd)

Type of data in the scope of this chapter:     
Here construction of variables for quarterly and monthly data 
quid about HF ? 
TABLE by data type 

ADD (to each chapter)

- scope by data type 

- contrast differences R vs GUI 


## Generating external regressors

### Outliers

#### Outlier Types

wo for hf data

#### Pre-specifying outliers 

Outliers are well-defined types of auxiliary variables, therefore when they are used (reg-arima or tramo modelling) they don't need to be explicitly
generated. This is detailed in chapters on [SA](A-sa.qmd) and [SA of High-frequency data](A-sa-hf.qmd). 

check: 

- in v2 fixing coefficients impossible? (window displayed as a calendar

- in v3 calendar window  or different window, allowing to fix coefficients

#### Generating regressors for outliers

Nevertheless, explicit regressors corresponding to outliers can be generated with `rjd3toolkit` functions for further use.independent use

```{r,eval=FALSE}
#Outliers in February 2002
library(rjd3toolkit)
ao <- ao_variable(12, c(2000,1), length = 12*4, date = "2002-02-01")
ls <- ls_variable(12, c(2000,1), length = 12*4, date = "2002-02-01")
tc <- tc_variable(12, c(2000,1), length = 12*4, date = "2002-02-01")
so <- so_variable(12, c(2000,1), length = 12*4, date = "2002-02-01")

```
More details rjd3toolkit help pages and vignette. 

### Ramp regressors 

What are ramps ?
To which component they are allocated ?

in R 
- step 1 generate 
- step 2 add as an external regressor to the estimation process (reg-arima modelling or full SA estimation)

in GUI 
- generation and addition step are merged as one (cf sa ?)
(sa chapter)

Differences between R and GUI

#### Adding ramps in GUI 

#### Generating ramp regressors in R


```{r,eval=FALSE}
# Ramp variable from January 2001 to September 2001
rp <- ramp_variable(12, c(2000,1), length = 12*4, range = c(13, 21))
# Or equivalently
rp<-ramp_variable(12, c(2000,1), length = 12*4, range = c("2001-01-01", "2001-09-02"))
plot.ts(rp)

```
More details rjd3toolkit help (how to set a link) pages and vignette 

#### Adding ramps in R 



### Intervention variables

why ? what is different from outliers (and ramps)
how can they be allocated 
details in component very important cf JP 

dans GUI intervention va dans reg_i ? always? can be selected 

can coefficient be fixes
je ne comprends pas fenetre dans GUI 

#### Adding intervention variables in GUI 


#### Generating intervention variables in R 

example

```{r,eval=FALSE}

iv<-intervention_variable(frequency=12, start=c(2000, 1), length=60,
                      starts = "2001-01-01", ends = "2001-12-01")
iv
plot(iv)

iv<-intervention_variable(12, c(2000, 1), 60,
                      starts = "2001-01-01", ends = "2001-12-01", delta = 1)
iv
plot(iv)

iv<-intervention_variable(12, c(2000, 1), 60,
                          starts = "2001-01-01", ends = "2001-12-01",
                          delta =0, seasonaldelta=1)
iv
plot(iv)
```
More details rjd3toolkit help (how to set a link) pages and vignette 


#### Adding intervention variables in R



### Periodic dummies and contrasts

why ? use case ?

in GUI not possible 

#### Generating regressors in R

dummies :as many time series as type of periods in a year (4,12)
periodic contrasts; objectif
```{r, eval= FALSE}
## periodic dummies : add explanations and examples
p<-periodic.dummies(4, c(2000,1), 60)
head(p)
class(p)
q<-periodic.contrasts(4, c(2000,1), 60) # erreur to be checked ?
q[1:9,]
```

contrasts
```{r, eval= FALSE}

```

#### Adding to estimation 

### Trigonometric variables 

use case: stable seaso
in what kind of model ?
allocation 
fixed coeff 
in GUI not possible (different algo)

#### Generating trigonometric regressors in R

```{r,eval=FALSE}


```
More details rjd3toolkit help (how to set a link) pages and vignette 

####  Adding trigonometric regressors in R

## Outlier Detection

### With Reg Arima models

#### Within an SA processing

cf function set outlier

here we are talking detection outside of an SA process 

#### Stand alone 

available in R packages 
independent function in 

- rjd3x13 

```{r,eval=FALSE, echo=TRUE}
regarima_outliers(rjd3toolkit::ABS$X0.2.09.10.M, order=c(1,1,1), seasonal=c(0,1,1), 
                  mean=F,
                  X=NULL, X.td=NULL, 
                  ao=T, ls=F, tc=T, so=T, cv=4)

```


- rjd3tramoseats

#### Specific TERROR tool

### With structural models (BSM)
