<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>JDemetra+ documentation - Tests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./M-state-space-framework.html" rel="next">
<link href="./M-Trend-Estimation-Local-Polynomials.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P_Methods.html">Methods</a></li><li class="breadcrumb-item"><a href="./M-tests.html">Tests</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">JDemetra+ documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./G-what-is-jd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JDemetra+ Software</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./G-jd-history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How JDemetra+ came to be</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Algorithms</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Adjustment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-hf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal adjustment of high-frequency data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-outlier-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outlier detection and Intervention variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-calendar-correction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calendar and user-defined corrections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Benchmarking and temporal disagreggation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-trend-cycle-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trend-cycle estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-nowcasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nowcasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-graphical-user-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphical User Interface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using JDemetra+ in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-Production-tools-cruncher-QR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Production, Cruncher and quality report</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-rev-policies-production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Production and revision policies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-plug-ins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plug-ins for JDemetra+</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-spectral-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spectral Analysis Principles and Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-reg-arima-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reg-Arima models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-X11-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">X-11 decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-STL-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STL: Local regression decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-SEATS-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEATS decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-Trend-Estimation-Local-Polynomials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trend Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-tests.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-state-space-framework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">State space modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-Temp-Disagg-Bench.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Temporal disaggregation and benchmarking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#tests-on-residuals" id="toc-tests-on-residuals" class="nav-link" data-scroll-target="#tests-on-residuals">Tests on residuals</a>
  <ul class="collapse">
  <li><a href="#ljung-box" id="toc-ljung-box" class="nav-link" data-scroll-target="#ljung-box">Ljung-Box</a></li>
  <li><a href="#box-pierce" id="toc-box-pierce" class="nav-link" data-scroll-target="#box-pierce">Box-Pierce</a></li>
  <li><a href="#dornik-hansen" id="toc-dornik-hansen" class="nav-link" data-scroll-target="#dornik-hansen">Dornik-Hansen</a></li>
  </ul></li>
  <li><a href="#seasonality-tests" id="toc-seasonality-tests" class="nav-link" data-scroll-target="#seasonality-tests">Seasonality tests</a>
  <ul class="collapse">
  <li><a href="#f-test-on-seasonal-dummies" id="toc-f-test-on-seasonal-dummies" class="nav-link" data-scroll-target="#f-test-on-seasonal-dummies">F-test on seasonal dummies</a></li>
  <li><a href="#identification-of-spectral-peaks" id="toc-identification-of-spectral-peaks" class="nav-link" data-scroll-target="#identification-of-spectral-peaks">Identification of spectral peaks</a></li>
  <li><a href="#friedman-test-for-stable-seasonality-test" id="toc-friedman-test-for-stable-seasonality-test" class="nav-link" data-scroll-target="#friedman-test-for-stable-seasonality-test">Friedman test for stable seasonality test</a></li>
  <li><a href="#moving-seasonality-test" id="toc-moving-seasonality-test" class="nav-link" data-scroll-target="#moving-seasonality-test">Moving seasonality test</a></li>
  <li><a href="#combined-seasonality-test" id="toc-combined-seasonality-test" class="nav-link" data-scroll-target="#combined-seasonality-test">Combined seasonality test</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tests</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This chapter describes all the tests available in JDemetra+, via Graphical User interface and/or R packages. An outline of the underlying theoretical principles of each test is provided.</p>
<p>The procedure to apply these tests in context is described when their use is relevant in the chapters dedicated to algorithms description, mainly on <a href="./A-sa.html">seasonal adjustment</a>.</p>
</section>
<section id="tests-on-residuals" class="level2">
<h2 class="anchored" data-anchor-id="tests-on-residuals">Tests on residuals</h2>
<table class="table">
<thead>
<tr class="header">
<th>Test</th>
<th>Purpose</th>
<th>GUI</th>
<th>R package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ljung-Box</td>
<td>autocorrelation</td>
<td>yes</td>
<td></td>
</tr>
<tr class="even">
<td>Box-Pierce</td>
<td>autocorrelation</td>
<td>yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Doornik-Hansen</td>
<td>normality</td>
<td>yes</td>
<td>rjd3tookit</td>
</tr>
</tbody>
</table>
<section id="ljung-box" class="level3">
<h3 class="anchored" data-anchor-id="ljung-box">Ljung-Box</h3>
<p>The Ljung-Box Q-statistics are given by:</p>
<p><span id="eq-1"><span class="math display">\[
\text{LB}\left( k \right) = n \times (n + 2) \times \sum_{k = 1}^{K}\frac{\rho_{a,k}^{2}}{n - k}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\rho_{a,k}^{2}\)</span> is the autocorrelation coefficient at lag <span class="math inline">\(k\)</span> of the residuals <span class="math inline">\({\widehat{a}}_{t}\)</span>, <span class="math inline">\(n\)</span> is the number of terms in differenced (? differenciated ?) series, <span class="math inline">\(K\)</span> is the maximum lag being considered, set in JDemetra+ to <span class="math inline">\(24\)</span> (monthly series) or <span class="math inline">\(8\)</span> (quarterly series).</p>
<p>If the residuals are random (which is the case for residuals from a well specified model), they will be distributed as <span class="math inline">\(\chi_{(K - m)}^{2}\)</span>, where <span class="math inline">\(m\)</span> is the number of parameters in the model which has been fitted to the data. (edit: not the residuals, but <span class="math inline">\(\widehat{\rho}\)</span> )</p>
<p>The Ljung-Box and Box-Pierce tests sometimes fail to reject a poorly fitting model. Therefore, care should be taken not to accept a model on a basis of their results. For the description of autocorrelation concept see section <a href="../theory/ACF_and_PACF.html">Autocorrelation function and partial autocorrelation function</a>.</p>
</section>
<section id="box-pierce" class="level3">
<h3 class="anchored" data-anchor-id="box-pierce">Box-Pierce</h3>
<p>The Box-Pierce Q-statistics are given by:</p>
<p><span class="math display">\[
\text{BP}\left( k \right) = n\sum_{k = 1}^{K}\rho_{a,k}^{2}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\rho_{a,k}^{2}\)</span> is the autocorrelation coefficient at lag <span class="math inline">\(k\)</span> of the residuals <span class="math inline">\({\widehat{a}}_{t}\)</span>.</p></li>
<li><p><span class="math inline">\(n\)</span> is the number of terms in differenced (differenciated?) series;</p></li>
<li><p><span class="math inline">\(K\)</span> is the maximum lag being considered, set in JDemetra+ to <span class="math inline">\(24\)</span> (monthly series) or <span class="math inline">\(8\)</span> (quarterly series).</p></li>
</ul>
<p>If the residuals are random (which is the case for residuals from a well specified model), they will be distributed as <span class="math inline">\(\chi_{(K - m)}^{2}\)</span> degrees of freedom, where <span class="math inline">\(m\)</span> is the number of parameters in the model which has been fitted to the data.(edit: same as above)</p>
</section>
<section id="dornik-hansen" class="level3">
<h3 class="anchored" data-anchor-id="dornik-hansen">Dornik-Hansen</h3>
<p>The Doornik-Hansen test for multivariate normality (DOORNIK, J.A., and HANSEN, H. (2008)) is based on the skewness and kurtosis of multivariate data that is transformed to ensure independence. It is more powerful than the Shapiro-Wilk test for most tested multivariate distributions<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>The skewness and kurtosis are defined, respectively, as: <span class="math inline">\(s = \frac{m_{3}}{\sqrt{m_{2}}^{3}}\)</span> and <span class="math inline">\(k = \frac{m_{4}}{m_{2}^{2}}\)</span>,</p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(m_{i} = \frac{1}{n}\sum_{i = 1}^{n}{(x_{i}}{- \overline{x})}^{i}\)</span> ;</p></li>
<li><p><span class="math inline">\(\overline{x} = \frac{1}{n}\sum_{i = 1}^{n}x_{i}\)</span> ;</p></li>
<li><p><span class="math inline">\(n\)</span> is a number of (non-missing) residuals.</p></li>
</ul>
<p>The Doornik-Hansen test statistic derives from SHENTON, L.R., and BOWMAN, K.O. (1977) and uses transformed versions of skewness and kurtosis.</p>
<p>The transformation for the skewness <span class="math inline">\(s\)</span> into <span class="math inline">\(\text{z}_{1}\)</span> is as in D’AGOSTINO, R.B. (1970):</p>
<p><span class="math display">\[
\beta = \frac{3(n^{2} + 27n - 70)(n + 1)(n + 3)}{(n - 2)(n + 5)(n + 7)(n + 9)}
\]</span></p>
<p><span class="math display">\[
\omega^{2} = - 1 + \sqrt{2(\beta - 1)}
\]</span></p>
<p><span class="math display">\[
\delta = \frac{1}{\sqrt{\log{(\omega}^{2})}}
\]</span></p>
<p><span class="math display">\[
y = s\sqrt{\frac{(\omega^{2} - 1)(n + 1)(n + 3)}{12(n - 2)}}
\]</span></p>
<p><span class="math display">\[
z_{1} = \delta log(y + \sqrt{y^{2} - 1})
\]</span></p>
<p>The kurtosis <span class="math inline">\(k\)</span> is transformed from a gamma distribution to <span class="math inline">\(\chi^{2}\)</span>, which is then transformed into standard normal <span class="math inline">\(z_{2}\)</span> using the Wilson-Hilferty cubed root transformation:</p>
<p><span class="math display">\[
\delta = (n - 3)(n + 1)(n^{2} + 15n - 4)
\]</span></p>
<p><span class="math display">\[
a = \frac{(n - 2)(n + 5)(n + 7)(n^{2} + 27n - 70)}{6\delta}
\]</span></p>
<p><span class="math display">\[
c = \frac{(n - 7)(n + 5)(n + 7)(n^{2} + 2n - 5)}{6\delta}
\]</span></p>
<p><span class="math display">\[
l= \frac{(n + 5)(n + 7)({n^{3} + 37n}^{2} + 11n - 313)}{12\delta}
\]</span></p>
<p><span class="math display">\[
\alpha = a + c \times s^{2}
\]</span></p>
<p><span class="math display">\[
\chi = 2l(k - 1 - s^{2})
\]</span></p>
<p><span class="math display">\[
z_{2} = \sqrt{9\alpha}\left( \frac{1}{9\alpha} - 1 + \sqrt[3]{\frac{\chi}{2\alpha}} \right)
\]</span></p>
<p>Finally, the Doornik-Hansen test statistic is defined as the sum of squared transformations of the skewness and kurtosis. Approximately, the test statistic follows a <span class="math inline">\(\chi^{2}\)</span> distribution, i.e.:</p>
<p><span class="math display">\[
DH = z_{1}^{2} + z_{2}^{2}\sim\chi^{2}(2)
\]</span></p>
</section>
</section>
<section id="seasonality-tests" class="level2">
<h2 class="anchored" data-anchor-id="seasonality-tests">Seasonality tests</h2>
<p>table with all tests by purpose and accessibility</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Purpose</th>
<th>GUI</th>
<th>R package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>QS test</td>
<td>Autocorrelation at seasonal lags</td>
<td>yes</td>
<td></td>
</tr>
<tr class="even">
<td>F-test with seasonal dummies</td>
<td>Stable seasonality</td>
<td>yes</td>
<td>rjd3sa</td>
</tr>
<tr class="odd">
<td>Identification of spectral peaks</td>
<td>Seasonal frequencies</td>
<td>yes</td>
<td>rjd3sa</td>
</tr>
<tr class="even">
<td>Friedman test</td>
<td>Stable seasonality</td>
<td>yes</td>
<td>rjd3sa</td>
</tr>
<tr class="odd">
<td>Two-way variance analysis</td>
<td>Moving seasonality</td>
<td>yes</td>
<td></td>
</tr>
</tbody>
</table>
<section id="qs-test-on-autocorrelation-at-seasonal-lags" class="level4">
<h4 class="anchored" data-anchor-id="qs-test-on-autocorrelation-at-seasonal-lags">QS Test on autocorrelation at seasonal lags</h4>
<p>The QS test is a variant of the <a href="../theory/Tests_LB.html">Ljung-Box</a> test computed on seasonal lags, where we only consider positive auto-correlations</p>
<p>More exactly,</p>
<p><span class="math display">\[
QS=n \left(n+2\right)\sum_{i=1}^k\frac{\left[ \max  \left(0, \hat\gamma_{i \cdot l}\right)\right]^2}{n-i \cdot l}
\]</span></p>
<p>where <span class="math inline">\(k=2\)</span>, so only the first and second seasonal lags are considered. Thus, the test would checks the correlation between the actual observation and the observations lagged by one and two years. Note that <span class="math inline">\(l=12\)</span> when dealing with monthly observations, so we consider the autocovariances <span class="math inline">\(\hat\gamma_{12}\)</span> and <span class="math inline">\(\hat\gamma_{24}\)</span> alone. In turn, <span class="math inline">\(k=4\)</span> in the case of quarterly data.</p>
<p>Under H0, which states that the data are independently distributed, the statistics follows a <span class="math inline">\(\chi \left(k\right)\)</span> distribution. However, the elimination of negative correlations makes it a bad approximation. The p-values would be given by <span class="math inline">\(P(\chi^{2}\left( k \right) &gt; Q)\)</span> for <span class="math inline">\(k = 2\)</span>. As <span class="math inline">\({P(\chi}^{2}(2)) &gt; 0.05 = 5.99146\)</span> and <span class="math inline">\({P(\chi}^{2}(2)) &gt; 0.01 = 9.21034\)</span>, <span class="math inline">\(QS &gt; 5.99146\)</span> and <span class="math inline">\(QS &gt; 9.21034\)</span> would suggest rejecting the null hypothesis at <span class="math inline">\(95\%\)</span> and <span class="math inline">\(99\%\)</span> significance levels, respectively.</p>
</section>
<section id="modification" class="level4">
<h4 class="anchored" data-anchor-id="modification">Modification</h4>
<p>Maravall (2012) proposes approximate the correct distribution (p-values) of the QS statistic using simulation techniques. Using 1000K replications of sample size 240, the correct critical values would be 3.83 and 7.09 with confidence levels of <span class="math inline">\(95\%\)</span> and <span class="math inline">\(99\%\)</span>, respectively (lower than the 5.99146 and 9.21034 shown above). For each of the simulated series, he obtains the distribution by assuming <span class="math inline">\(QS=0\)</span> when <span class="math inline">\(\hat\gamma_{12}\)</span>, so in practice this test will detect seasonality only when any of these conditions hold: - Statistically significant positive autocorrelation at lag 12 - Non-negative sample autocorrelation at lag 12 and statistically significant positive autocorrelation at lag 24</p>
</section>
<section id="use" class="level4">
<h4 class="anchored" data-anchor-id="use">Use</h4>
<p>The test can be applied directly to any series by selecting the option <em>Statistical Methods &gt;&gt; Seasonal Adjustment &gt;&gt; Tools &gt;&gt; Seasonality Tests</em>. This is an example of how results are displayed for the case of a monthly series:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/qs.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">qs</figcaption>
</figure>
</div>
<p>The test can be applied to the input series before any seasonal adjustment method has been applied. It can also be applied to the seasonally adjusted series or to the irregular component.</p>
</section>
<section id="references" class="level4">
<h4 class="anchored" data-anchor-id="references">References</h4>
<ul>
<li>LJUNG G. M. and G. E. P. BOX (1978). “On a Measure of a Lack of Fit in Time Series Models”. Biometrika 65 (2): 297–303. doi:10.1093/biomet/65.2.297</li>
<li>MARAVALL, A. (2011). “Seasonality Tests and Automatic Model Identification in Tramo-Seats”. Manuscript</li>
<li>MARAVALL, A. (2012). “Update of Seasonality Tests and Automatic Model Identification in TRAMO-SEATS”. Bank of Spain (November 2012)</li>
</ul>
</section>
<section id="f-test-on-seasonal-dummies" class="level3">
<h3 class="anchored" data-anchor-id="f-test-on-seasonal-dummies">F-test on seasonal dummies</h3>
<p>The F-test on seasonal dummies checks for the presence of deterministic seasonality. The model used here uses seasonal dummies (mean effect and 11 seasonal dummies for monthly data, mean effect and 3 for quarterly data) to describe the (possibly transformed) time series behaviour. The test statistic checks if the seasonal dummies are jointly statistically not significant. When this hypothesis is rejected, it is assumed that the deterministic seasonality is present and the test results are displayed in green.</p>
<p>This test refers to Model-Based <span class="math inline">\(\chi^{2}\ \)</span> and F-tests for Fixed Seasonal Effects proposed by LYTRAS, D.P., FELDPAUSCH, R.M., and BELL, W.R. (2007) that is based on the estimates of the regression dummy variables and the corresponding t-statistics of the Reg-Arima model, in which the ARIMA part of the model has a form (0,1,1)(0,0,0). The consequences of a misspecification of a model are discussed in LYTRAS, D.P., FELDPAUSCH, R.M., and BELL, W.R. (2007).</p>
<p>For a monthly time series the Reg-Arima model structure is as follows:</p>
<p><span class="math display">\[
\left( 1 - B \right)\left( y_{t} - \beta_{1}M_{1,t} - \ldots - \beta_{11}M_{11,t} - \gamma X_{t} \right) = \mu + (1 - B)a_{t}
\]</span> <!--- \[7.155\]     --></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(M_{j,t} =\begin{cases}1 &amp; \text{ in month } j = 1, \ldots, 11 \\- 1 &amp; \text{ in December}\\0 &amp; \text{ otherwise}\end{cases} \text{ - dummy variables;}\)</span></p></li>
<li><p><span class="math inline">\(y_{t}\)</span> – the original time series;</p></li>
<li><p><span class="math inline">\(B\)</span> – a backshift operator;</p></li>
<li><p><span class="math inline">\(X_{t}\)</span> – other regression variables used in the model (e.g.&nbsp;outliers, calendar effects, user-defined regression variables, intervention variables);</p></li>
<li><p><span class="math inline">\(\mu\)</span> – a mean effect;</p></li>
<li><p><span class="math inline">\(a_{t}\)</span> – a white-noise variable with mean zero and a constant variance.</p></li>
</ul>
<p>In the case of a quarterly series the estimated model has a form:</p>
<p><span id="eq-2"><span class="math display">\[
\left( 1 - B \right)\left( y_{t} - \beta_{1}M_{1,t} - \ldots - \beta_{3}M_{3,t} - \gamma X_{t} \right) = \mu + (1 - B)a_{t}
\tag{2}\]</span></span> <!--- \[7.156\]     --></p>
<p>where:</p>
<p><span class="math display">\[
M_{j,t} =
\begin{cases}
1 &amp; \text{ in quarter} j = 1, \ldots, 3 \\
- 1 &amp; \text{ in the fourth quarter}\\
0 &amp; \text{ otherwise}
\end{cases} \text{ - dummy variables;}
\]</span></p>
<p>One can use the individual t-statistics to assess whether seasonality for a given month is significant, or a chi-squared test statistic if the null hypothesis is that the parameters are collectively all zero. The chi-squared test statistic is <span class="math inline">\({\widehat{\chi}}^{2} = {\widehat{\beta}}^{'}{\lbrack Var(\widehat{\beta})}^{\ })^{- 1}\rbrack{\widehat{\beta}}^{\ }\)</span> in this case compared to critical values from a <span class="math inline">\(\chi^{2}\left( \text{df} \right)\)</span>-distribution, with degrees of freedom <span class="math inline">\(df = 11\)</span> (monthly series) or <span class="math inline">\(df = 3\)</span> (quarterly series). Since the <span class="math inline">\({Var(\widehat{\beta})}^{\ }\)</span> computed using the estimated variance of <span class="math inline">\(\alpha_{t}\)</span> may be very different from the actual variance in small samples, this test is corrected using the proposed <span class="math inline">\(\text{F}\)</span> statistic:</p>
<p><span class="math display">\[
F = \frac{ {\widehat{\chi}}^{2}}{s - 1} \times \frac{n - d - k}{n - d}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(d\)</span> is the degree of differencing, s is time series frequency (12 for a monthly series, 4 for a quarterly series) and <span class="math inline">\(k\)</span> is the total number of regressors in the Reg-Arima model (including the seasonal dummies <span class="math inline">\(\text{M}_{j,t}\)</span> and the intercept).</p>
<p>This statistic follows a <span class="math inline">\(F_{s - 1,n - d - k}\)</span> distribution under the null hypothesis.</p>
</section>
<section id="identification-of-spectral-peaks" class="level3">
<h3 class="anchored" data-anchor-id="identification-of-spectral-peaks">Identification of spectral peaks</h3>
</section>
<section id="friedman-test-for-stable-seasonality-test" class="level3">
<h3 class="anchored" data-anchor-id="friedman-test-for-stable-seasonality-test">Friedman test for stable seasonality test</h3>
<p>The Friedman test is a non-parametric method for testing that samples are drawn from the same population or from populations with equal medians. The significance of the month (or quarter) effect is tested. The Friedman test requires no distributional assumptions. It uses the rankings of the observations. If the null hypothesis of no stable seasonality is rejected at the 0.10% significance level then the series is considered to be seasonal and the test’s outcome is displayed in green.</p>
<p>The test statistic is constructed as follows. Consider first the matrix of data <span class="math inline">\(\left\{x_{ij}\right\}_{n \times k}\)</span> with <span class="math inline">\(n\)</span> rows (the blocks, i.e.&nbsp;number of years in the sample), <span class="math inline">\(k\)</span> columns (the treatments, i.e.&nbsp;either 12 months or 4 quarters, depending on the frequency of the data).<br>
The data matrix needs to be replaced by a new matrix <span class="math inline">\(\left\{r_{ij}\right\}_{n \times k}\)</span>, where the entry <span class="math inline">\(r_{ij}\)</span> is the rank of <span class="math inline">\(x_{ij}\)</span> within block <span class="math inline">\(i\)</span> .</p>
<p>The test statistic is given by</p>
<p><span class="math display">\[
Q=\frac{SS_t}{SS_e}
\]</span></p>
<p>where <span class="math inline">\(SS_t=n \sum_{j=1}^{k}(\bar{r}_{.j}-\bar{r})^2\)</span> and <span class="math inline">\(SS_e=\frac{1}{n(k-1)} \sum*{i=1}^{n}*\sum{j=1}^{k}(r_{ij}-^\bar{r})2\)</span>. It represents the variance of the average ranking across treatments j relative to the total.</p>
<p>Under the hypothesis of no seasonality, all months can be equally treated. For the sake of completeness: - <span class="math inline">\(\bar{r}*{.j}\)</span> is the average ranks of each treatment (month) j within each block (year) - The average rank is given by <span class="math inline">\(* \bar{r}=\frac{1}{nk}\sum{i=1}^{n}\sum*{j=1}^{k}(r*{ij})\)</span></p>
<p>For large <span class="math inline">\(n\)</span> or <span class="math inline">\(k\)</span> , i.e.&nbsp;<span class="math inline">\(n &gt; 15\)</span> or <span class="math inline">\(k &gt; 4\)</span>, the probability distribution of <span class="math inline">\(Q\)</span> can be approximated by that of a chi-squared distribution. Thus, the p-value is given by <span class="math inline">\(P( \chi^2_{k-1}&gt;Q)\)</span>.</p>
<section id="use-1" class="level4">
<h4 class="anchored" data-anchor-id="use-1">Use</h4>
<p>The test can be applied directly to any series by selecting the option <em>Statistical Methods &gt;&gt; Seasonal Adjustment &gt;&gt; Tools &gt;&gt; Seasonality Tests</em>. This is an example of how results are displayed for the case of a monthly series:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/friedman.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">friedman</figcaption>
</figure>
</div>
<p>If the null hypothesis of no stable seasonality is rejected at the 1% significance level, then the series is considered to be seasonal and the outcome of the test is displayed in green.</p>
<p>The test can be applied to the input series before any seasonal adjustment method has been applied. It can also be applied to the seasonally adjusted series or to the irreguar component. In the case of X-13ARIMA-SEATS, the test is applied to the preliminary estimate of the unmodified Seasonal-Irregular component<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> (time series shown in Table B3). In this estimate, the number of observations is lower than in the final estimate of the unmodified Seasonal-Irregular component. Thus, the number of degrees of freedom in the stable seasonality test is lower than the number of degrees of freedom in the test for the presence of seasonality assuming stability. For example, X-13ARIMA-SEATS uses a centred moving average of order 12 to calculate the preliminary estimation of trend. Consequently, the first six and last six points in the series are not computed at this stage of calculation. The preliminary estimation of the trend is then used for the calculation of the preliminary estimation of the unmodified Seasonal-Irregular.</p>
</section>
<section id="related-tests" class="level4">
<h4 class="anchored" data-anchor-id="related-tests">Related tests</h4>
<ul>
<li>When using this kind of design for a binary response, one instead uses the Cochran’s Q test.</li>
<li>Kendall’s W is a normalization of the Friedman statistic between 0 and 1.</li>
<li>The Wilcoxon signed-rank test is a nonparametric test of non-independent data from only two groups.</li>
</ul>
</section>
<section id="references-1" class="level4">
<h4 class="anchored" data-anchor-id="references-1">References</h4>
<ul>
<li><p>Friedman, Milton (December 1937). “The use of ranks to avoid the assumption of normality implicit in the analysis of variance”. Journal of the American Statistical Association (American Statistical Association) 32 (200): 675–701. doi:10.2307/2279372. JSTOR 2279372.</p></li>
<li><p>Friedman, Milton (March 1939). “A correction: The use of ranks to avoid the assumption of normality implicit in the analysis of variance”. Journal of the American Statistical Association (American Statistical Association) 34 (205): 109. doi:10.2307/2279169. JSTOR</p>
<ol start="2279169" type="1">
<li></li>
</ol></li>
<li><p>Friedman, Milton (March 1940). “A comparison of alternative tests of significance for the problem of m rankings”. The Annals of Mathematical Statistics 11 (1): 86–92. doi:10.1214/aoms/1177731944. JSTOR 2235971.</p></li>
</ul>
</section>
</section>
<section id="moving-seasonality-test" class="level3">
<h3 class="anchored" data-anchor-id="moving-seasonality-test">Moving seasonality test</h3>
<p>The evolutive seasonality test is based on a two-way analysis of variance model. The model uses the values from complete years only. Depending on the decomposition type for the Seasonal – Irregular component it uses <a href="#eq-1">Equation&nbsp;<span>1</span></a> (in the case of a multiplicative model) or <a href="#eq-2">Equation&nbsp;<span>2</span></a> (in the case of an additive model):</p>
<p><span class="math display">\[
\left|\text{SI}_{\text{ij}} - 1 \right| = X_{\text{ij}} = b_{i} + m_{j} + e_{\text{ij}}
\]</span> <!---  \[7.148\]     --></p>
<p><span class="math display">\[
\left| \text{SI}_{\text{ij}} \right| = X_{\text{ij}} = b_{i} + m_{j} + e_{\text{ij}}
\]</span> <!---  \[7.149\]     --></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(m_{j}\)</span> – the monthly or quarterly effect for <span class="math inline">\(j\)</span>-th period, <span class="math inline">\(j = (1,\ldots,k)\)</span>, where <span class="math inline">\(k = 12\)</span> for a monthly series and <span class="math inline">\(k = 4\)</span> for a quarterly series;</p></li>
<li><p><span class="math inline">\(b_{j}\)</span> – the annual effect <span class="math inline">\(i\)</span>, <span class="math inline">\((i = 1,\ldots,N)\)</span> where <span class="math inline">\(N\)</span> is the number of complete years;</p></li>
<li><p><span class="math inline">\(e_{\text{ij}}\)</span> – the residual effect.</p></li>
</ul>
<p>The test is based on the following decomposition:</p>
<p><span id="eq-3"><span class="math display">\[
S^{2} = S_{A}^{2} + S_{B}^{2} + S_{R}^{2},
\tag{3}\]</span></span> <!---  \[7.150\]     --></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(S^{2} = \sum_{j = 1}^{k}{\sum_{i = 1}^{N}\left( {\overline{X}}_{\text{ij}} - {\overline{X}}_{\bullet \bullet} \right)^{2}}\)</span> –the total sum of squares;</p></li>
<li><p><span class="math inline">\(S_{A}^{2} = N\sum_{j = 1}^{k}\left( {\overline{X}}_{\bullet j} - {\overline{X}}_{\bullet \bullet} \right)^{2}\)</span> – the inter-month (inter-quarter, respectively) sum of squares, which mainly measures the magnitude of the seasonality;</p></li>
<li><p><span class="math inline">\(S_{B}^{2} = k\sum_{i = 1}^{N}\left( {\overline{X}}_{i \bullet} - {\overline{X}}_{\bullet \bullet} \right)^{2}\)</span> – the inter-year sum of squares, which mainly measures the year-to-year movement of seasonality;</p></li>
<li><p><span class="math inline">\(S_{R}^{2} = \sum_{i = 1}^{N}{\sum_{j = 1}^{k}\left( {\overline{X}}_{\text{ij}} - {\overline{X}}_{i \bullet} - {\overline{X}}_{\bullet j} - {\overline{X}}_{\bullet \bullet} \right)^{2}}\)</span> – the residual sum of squares.</p></li>
</ul>
<p>The null hypothesis <span class="math inline">\(H_{0}\)</span> is that <span class="math inline">\(b_{1} = b_{2} = ... = b_{N}\)</span> which means that there is no change in seasonality over the years. This hypothesis is verified by the following test statistic:</p>
<p><span class="math display">\[
F_{M} = \frac{\frac{S_{B}^{2}}{(n - 1)}}{\frac{S_{R}^{2}}{(n - 1)(k - 1)}}
\]</span></p>
<p>which follows an <span class="math inline">\(F\)</span>-distribution with <span class="math inline">\(k - 1\)</span> and <span class="math inline">\(n - k\)</span> degrees of freedom.</p>
</section>
<section id="combined-seasonality-test" class="level3">
<h3 class="anchored" data-anchor-id="combined-seasonality-test">Combined seasonality test</h3>
<p>This test combines the Kruskal-Wallis test along with test for the presence of seasonality assuming stability (<span class="math inline">\(F_{S}\)</span>), and evaluative seasonality test for detecting the presence of identifiable seasonality (<span class="math inline">\(F_{M}\)</span>). Those three tests are calculated using the final unmodified SI component. The main purpose of the combined seasonality test is to check whether the seasonality of the series is identifiable. For example, the identification of the seasonal pattern is problematic if the process is dominated by highly moving seasonality<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. The testing procedure is shown in the figure below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_A_image18.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Combined seasonality test, source: LADIRAY, D., QUENNEVILLE, B. (2001)</strong></figcaption>
</figure>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The description of the test derives from DOORNIK, J.A., and HANSEN, H. (2008).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The unmodified Seasonal-Irregular component corresponds to the Seasonal-Irregular factors with the extreme values.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>DAGUM, E.B. (1987).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./M-Trend-Estimation-Local-Polynomials.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Trend Estimation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./M-state-space-framework.html" class="pagination-link">
        <span class="nav-page-text">State space modelling</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>