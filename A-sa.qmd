# Seasonal Adjustment {.unnumbered}

Hint at GUI chap for global principles - ws structure (new SAP) - global specification handling - file structure explanation

Hint at tool selection (link to chapter)

## Motivation

The primary aim of the seasonal adjustment process is to remove seasonal fluctuations from the time series. Seasonal fluctuations are quasi-periodic infra-annual movements. They can mask...

\[insert def SA from b_ov\]

-   infra annual peridodic numbers
-   no unamigous definititon
-   depends on its practial estimation

## Data frequencies : high and low

Until recently seasonal where designed to tackly monthly frequencies or lower in JD+, X13- Seats Arima : 2,4,12 Seats : 2,3,4,6,12

For infra monthly data

## Unobserved Components (UC)

The main components, each representing the impact of certain types of phenomena on the time series ($X_{t}$), are:

-   The trend ($T_{t}$) that captures long-term and medium-term behaviour;

-   The seasonal component ($S_{t}$) representing intra-year fluctuations, monthly or quarterly, that are repeated more or less regularly year after year;

-   The irregular component ($I_{t}$) combining all the other more or less erratic fluctuations not covered by the previous components.

In general, the trend consists of 2 sub-components:

-   The long-term evolution of the series;

-   The cycle, that represents the smooth, almost periodic movement around the long-term evolution of the series. It reveals a succession of phases of growth and recession. Trend and cycle are not separated in SA alogrithms.

Two decomposition models:

-   The additive model: $X_{t} = T_{t} + S_{t} + I_{t}$;

-   The multiplicatve model: $X_{t} = T_{t} \times S_{t} \times I_{t}$.

In the Reg-Arima (link) or Tramo(link) modelling the the multplicative model is estimated in logs; $log(X_{t}) = log(T_{t}) + log(S_{t}) + log(I_{t})$; Seats decompostion also relies on logs wheres X-11 decomp operates...

## Detecting seasonal patterns

Seasonality tests (chap M_Tests)

## Available algorithms

(link to table)

The two most popular are..

X-13ARIMA is a seasonal adjustment program developed and supported by the U.S. Census Bureau. It is based on the U.S. Census Bureau's earlier X-11 program, the X-11-ARIMA program developed at Statistics Canada, the X-12-ARIMA program developed by the U.S. Census Bureau.

Tramo-Seats

Those will be the most detailed in this doc, but there alternative solutions.

STL

BSM

X13 and TS are two step algos, pretreatment +dcomp (no pre ptreatment in STL + all at once in BSM)

-   pre-treatment objectives and methods

-   decomposition objective and methods

## Pre-treatment : Reg-ARIMA (or TRAMO)

rationale 

NOTE: Modelling

this should just be a "note" not a part

(small addendum) the reg arima part can be run without decompostion slight differences in parameters

ref to additionnal chapter ?

### Global outline

let's call it regArima modelling (and tramo only when TRamo differences are outlined)

GOAL : remove deterministic effects to improve decompostion (details on modelling: link)

global structure regression with ARIMA structure for residuals $$
Y_t = \sum {\alpha}_i O_{it} + \sum\beta_j C_{jt} + \sum {\gamma}_i U_{it} + Y_{lin,t}
$$ where - $O_{it}$ are the $i$ final outliers (Ao, LS, TC) from an automatic detection pocedure (link to outliers chap)

-   $C_{it}$ are the calendar regressors (automatic or user-defined) (link to calendar chap)

-   $U_{it}$ are all the other user-defined regressors (link to outliers and regressors chap)

-   $Y_{lin,t} \sim ARIMA(p,d,q)(P,D,Q)$

In the following sections we cover in more details: not the tight structure - Default params: (quick launch) INPUT (?) - Setting User-defined parameters (and not at the end post diagnostics ?) - Output1: series - Output2: Final Params - Output3: Diagnostics for each of these steps - calendar (auto and user) - outliers (auto and user) - adding intervention variables (here: just how to feed the model, details on regressor and calendar specif chapter) - aima models parameters annd diagno

RegArima modelling part can be of an SA process or run on its own - GUI - R (sligthly different specs,...)

WARNING : set params + retrieve their values: global principles

in GUI

Retrieve: in the specification window and panels for main (to detail ?)

in R

### Default Specifications

here general explanations

default specification are set for the whole sa procedure: pre-treatment end decomposition

they are slightly different for X13-ARIMA and tramo seats

the user chooses the algo + one default spec

this default spec can be modified with user defined params for most of its parts, this is tackeled in details dor every sub part of the reg arima (tramo) modelling and corresponding decompostion (x11 and seats)

Strating point for X13-ARIMA

| Spec identifier | Log/level detection | Outliers detection | Calendar effects | ARIMA          |
|-----------------|---------------------|--------------------|------------------|----------------|
| RSA0            | *NA*                | *NA*               | *NA*             | Airline(+mean) |
| RSA1            | automatic           | AO/LS/TC           | *NA*             | Airline(+mean) |
| RSA2c           | automatic           | AO/LS/TC           | 2 TD vars+Easter | Airline(+mean) |
| RSA3            | automatic           | AO/LS/TC           | *NA*             | automatic      |
| RSA4c           | automatic           | AO/LS/TC           | 2 TD vars+Easter | automatic      |
| RSA5            | automatic           | AO/LS/TC           | 7 TD vars+Easter | automatic      |
| X-11            | *NA*                | *NA*               | *NA*             | *NA*           |

explanations :

*NA :* non applied

X11

RSA0

RSA3: no calendar effect correction

automatic: test is performed,

outliers : AO/LS/TC type of outliers automatically detected under a critical T-Stat value (defautl value=4)

calendar

-   2 regresssors: weekdays vs week-ends + LY

-   7 regressors: each week day vs sunadys + LY

-   always tested

-   easter tested (length = 6 days in tramo, 8 days in X13 arima)

arima model automatic detection

TEST : RSA0 : mult or add

TD vars include LY (link to calendar)

Strating point for Tramo-Seats

| Spec identifier | Log/level detection | Outliers detection | Calendar effects | ARIMA          |
|-----------------|---------------------|--------------------|------------------|----------------|
| RSA0            | *NA*                | *NA*               | *NA*             | Airline(+mean) |
| RSA1            | automatic           | AO/LS/TC           | *NA*             | Airline(+mean) |
| RSA2            | automatic           | AO/LS/TC           | 2 TD vars+Easter | Airline(+mean) |
| RSA3            | automatic           | AO/LS/TC           | *NA*             | automatic      |
| RSA5            | automatic           | AO/LS/TC           | 6 TD vars+Easter | automatic      |
| RSAfull         | automatic           | AO/LS/TC           | automatic        | automatic      |

Principle of user setting parameters: can be done from one of the default specs or any spec in "save" as mode very similar inGUI and R

### Spans

#### Estimation span

principle + some differences between tramo and reg-arima

Specifies the span (data interval) of the time series to be used in the seasonal adjustment process (no computations outside) The user can restrcit the span

Table Common settings

| Option            | Description (expected format)                                                                                                                                              |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| All               | default                                                                                                                                                                    |
| From              | first observation included (yyyy-mm-dd)                                                                                                                                    |
| To                | last observation included (yyyy-mm-dd)                                                                                                                                     |
| Between           | interval \[from ; to\] inculded (yyyy-mm-dd to yyyy-mm-dd)                                                                                                                 |
| First             | number of obs from the begining of the series included (dynamic) (integer)                                                                                                 |
| Last              | number of obs from the end of the series (dynamic)(integer)                                                                                                                |
| Excluding         | excluding N first obs and P last obs from the computation,dynamic) (integer)                                                                                               |
| Preliminary check | chek to exclude highly problematic series e.g. the series with a number of identical observations and/or missing values above pre-specified threshold values. (True/False) |
|                   |                                                                                                                                                                            |
|                   |                                                                                                                                                                            |
|                   |                                                                                                                                                                            |
|                   |                                                                                                                                                                            |

Setting in GUI image1: specification window and expanded nodes

Setting in R, part of modifying a specification (link)

```{r, EVAL=FALSE}
library(RJDemetra)
# estimation interval: option with static dates
user_spec_1<-x13_spec(spec = c("RSA5c", "RSA0", "RSA1", "RSA2c", "RSA3", "RSA4c", "X11"), 
preliminary.check = TRUE, 
estimate.from = "2012-06-01", 
estimate.to = "2019-12-01") 

# estimation interval: option with dynamic numbers of observations

# 
# spec can be applied on different series and therefore exclude different dates
user_spec_2<-x13_spec(spec = c("RSA5c", "RSA0", "RSA1", "RSA2c", "RSA3", "RSA4c", "X11"), 
estimate.first = 12) 

# eestimation on the last 120 obs
user_spec_3<-x13_spec(spec = c("RSA5c", "RSA0", "RSA1", "RSA2c", "RSA3", "RSA4c", "X11"), 
estimate.last = 120)

#excluding first 24 and last 36 observations
user_spec_4<-x13_spec(spec = c("RSA5c", "RSA0", "RSA1", "RSA2c", "RSA3", "RSA4c", "X11"), 
estimate.exclFirst = 24, 
estimate.exclLast = 36)

# Retrieve settings

```

For comprehensive details about x13_spec function see {RJDemetra} documentation for tramo seats : the same ..one example outlining differences

\[V3(JDemetra+ V3) Example in X13\]

Tramo-seats

(JD+ version 2) With RJDemetra, example in Tramo-Seats:

```{r, eval=FALSE}

#excluding first 24 and last 36 observations
user_spec_1<-tramoseats_spec( spec = c("RSAfull", "RSA0", "RSA1", "RSA2", "RSA3", "RSA4", "RSA5"),  
estimate.exclFirst = 24, 
estimate.exclLast = 36)

```

#### Model span

Principle: same as estimation span (link) above

Specifies the span (data interval) of the time series to be used for the estimation of the RegARIMA model coefficients. The RegARIMA model is then applied to the whole series. With this argument the data early in the series can be prevented from affecting the forecasts, or, alternatively, data later in the series are excluded from the modelling span, so that they do not influence the regression estimates. The available parameter values are

Additionnal parameters

Model span specific parameters

+--------------------------+-----------------------------------------------------------------------------------------------------------------------------+
| Tolerance                | Convergence tolerance for the nonlinear estimation.                                                                         |
|                          |                                                                                                                             |
|                          | The absolute changes in the log-likelihood are compared to Tolerance to check the convergence of the estimation iterations. |
|                          |                                                                                                                             |
|                          | The default setting is 0.0000001.                                                                                           |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------+
| Tramo specifc parameters |                                                                                                                             |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------+
| Exact ML                 | When this option is marked, an exact maximum likelihood estimation is performed.                                            |
|                          |                                                                                                                             |
|                          | Alternatively, the Unconditional Least Squares method is used.                                                              |
|                          |                                                                                                                             |
|                          | However, in the current version of JDemetra+ it is not recommended to change this parameter's value                         |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------+
| Unit Root Limit          | Limit for the autoregressive roots. If the inverse of a real root of the autoregressive polynomial of the                   |
|                          |                                                                                                                             |
|                          | ARIMA model is higher than this limit, the root is set equal to 1. The default parameter value is 0.96.                     |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------+

Retrieve in GUI:

image specification window and nodes

Retrieve in R: not possible (to confirm), estimation span and model span must be equal

so additional parameters for model span are set on the estimation span

Tramo seats exemple

```{r, eval=FALSE}

#excluding first 24 and last 36 observations
user_spec_1<-tramoseats_spec( spec = c("RSAfull", "RSA0", "RSA1", "RSA2", "RSA3", "RSA4", "RSA5"),  
estimate.tol = 0.0000001, 
estimate.eml = FALSE, 
estimate.urfinal = 0.98)

```

\[V3 model span specif parameters\]

### Decomposition Scheme

Principle

ecriture add

ecriture multi

if multi : log

ecriture log

consequences on X11 decomp and seats decomp

Transformation test -- a test is performed to choose between an additive decomposition (no transformation) (link to reg A chap to detail this)

Settings

Function

transform {function=}

Transformation of data. 2 The user can choose between:

None -- no transformation of the data;

Log -- takes logs of the data;

Auto -- the program tests for the log-level specification. This option is recommended for automatic modelling of many series.

The default setting is Auto.

Reg-Arima specific settings

AIC difference

transform {aicdiff=}

Defines the difference in AICC needed to accept no transformation over a log transformation when the automatic transformation

    selection option is invoked. The option is disabled when Function is not set to Auto. The default AIC difference value is -2.

Adjust

transform {adjust=}

Options for proportional adjustment for the leap year effect. The option is available when Function is set to Log. Adjust can be set to:

LeapYear -- performs a leap year adjustment of monthly or quarterly data;

LengthofPeriod -- performs a length-of-month adjustment on monthly data or length-of-quarter adjustment on quarterly data;

None -- does not include a correction for the length of the period.

The default setting is None

Tramo specific settings

**Fct**\
*Transformation; fct*

Controls the bias in the log/level pre-test (the function is active when **Function** is set to *Auto*); **Fct** \> 1 favours levels, **Fct** \< 1 favours logs. The default setting is 0.95.

Set and Retrieve in GUI

Image specification window + expanded nodes : RegA+ Tramo

Retrieve: in the specification window and panels for main (to detail ?)

Set and in R

X13

```{r, eval=FALSE}

#excluding first 24 and last 36 observations
user_spec <-x13_spec(spec = c("RSA5c", "RSA0", "RSA1", "RSA2c", "RSA3", "RSA4c", "X11"), 
transform.function ="Log", # c(NA, "Auto", "None", "Log"),
transform.adjust = "LeapYear", #c(NA, "None", "LeapYear", "LengthOfPeriod"),
transform.aicdiff = -3)

#Retrieve settings


```

Tramo seats settings

```{r, eval=FALSE}

#transfo
user_spec_1<-tramoseats_spec( spec = c("RSAfull", "RSA0", "RSA1", "RSA2", "RSA3", "RSA4", "RSA5"),  
transform.function = "Auto", #c(NA, "Auto", "None", "Log"), 
transform.fct = 0.5)

 
# Retrieve settings  

```

### Calendar correction

Rationale : why correct (in a nutshell)

Method regression as deterministic effects, details of regressor building in calendar chapter

#### Default specifications for calendar correction

Options related to calendar regressors choice are embedded into default specifications (link)

National calendars not taken into accout.

-   working days

-   trading days

-   Leap year regressor

-   Test: Remove/ Add / None

-   Easter

-   Test add / remove / non

-   duration (enabled when testing removed)

-   Julian

-   pre-test

##### GUI: Setting this options and retrieveing parameters which are in use

##### R: Setting this options and retrieveing parameters which are in use

#### Customizing calendars

How to correct this ?

solution 1: if working with GUI build a new calendar in GUI 
(building details in chap C) set this option import it : here

GUI : how to use it or customize HTML file structure explanation

Question: can rjd3modelling generate an HTML calendar for GUI

set this option in GUI

image: spec window calendar / holdays / choics of calendar 

set this option in R ?

version 2: 

version 3:

solution 2: import external regressors can be built with rjd3modelling (link) which can then be used in via are or imported via GUI

set this option in GUI
how to import vaiables into JD+ / set utility (in interface chapter)
calssical user defined 

set this option in R
version 2: 
```{r, eval=FALSE}
spec_4 <- x13_spec(spec = spec_1, 
                   tradingdays.option = "UserDefined", 
                   tradingdays.test = "None", 
                   usrdef.varEnabled = TRUE, 
                   usrdef.varType = "Calendar", 
                   usrdef.var = reg3) # set of regressors in TS format
```

version 3


(generic sentence to quasi repeat at the end of each part) 
Once regressors set, the RegArima (tramo) model will be estimated gloablly with all the other regression variables and taking into account arima model specificities as well. That is why diagnostics are all jointly displayed at the end of the process. (link)

link to: worked example: french calendar in R

### Outliers and intervention variables

quick intro: rational = improve decomposition (cf guidelines)
(determinsitic= effects estimated by regression 
2 ways 
- (customizable) automatic detection 
- user prespecifified outliers 


#### Automatic detection

overview: one sentence

##### what can be set (list)

(what do we look for) : AO, LS, TC (detailed in outliers chapter link), 
how cf. RegArima method chapter
types can be set and TC rate specified 
SO can be added to detection
detection
- detection enabled
- detection span
- types of outliers (+ rate for TC)
- critical value 
("method" = is an incative parameter, always add one)

all is identic for TRamo

###### how to set this in GUI 

image specification window, outliers box commented

##### how ro set this in R
version 2: RJDemetra

```{r, eval=FALSE}
# idem for x13 or tramo
# spec_4 <- x13_spec(spec = spec_1, 
# outlier.enabled = NA,
#   outlier.from = NA_character_,
#   outlier.to = NA_character_,
#   outlier.first = NA_integer_,
#   outlier.last = NA_integer_,
#   outlier.exclFirst = NA_integer_,
#   outlier.exclLast = NA_integer_,
#   outlier.ao = NA,
#   outlier.tc = NA,
#   outlier.ls = NA,
#   outlier.so = NA,
#   outlier.usedefcv = NA,
#   outlier.cv = NA_integer_,
#   outlier.method = c(NA, "AddOne", "AddAll"),
#   outlier.tcrate = NA_integer_,

```


(how to retrieve these settings? in regression results cf end) )


#### Pre-specified Outliers

the user can set outliers (in the past)
will be complemented by automatic detection (unless disabled)

##### in GUI

image specif window open the calendar
image of calendar

##### how to set this in R
version 2: RJDemetra

```{r, eval=FALSE}
# idem for x13 or tramo
# spec_4 <- x13_spec(spec = spec_1, 


```

#### Other User-defined regressors 


rjd3modelling

some principles 
- allocate to a component
- out of calendars and outliers warning: calendars won't be allocated to calendars, if not...


##### Import regressors in GUI

- import 
- additionnal operations

##### Import regressors R
```{r,eval=FALSE}

spec_5 <- x13_spec(spec = spec_1, 
                   usrdef.varEnabled = TRUE, 
                   # On choisit d'attribuer l'outlier à la composante tendance
                   usrdef.varType = "Trend", 
                   # Les régresseurs doivent être au format ts
                   usrdef.var = reg_externe_ts)

```

### Arima Model

Once regressors have been defined, the software looks for a structure of the autocorrelations of the lneariezd series 

The arima model will be evaluated lookng at its residuals supposed to be a whiet noise



#### Default specifications

Key specifications on arima model are embedded in default specifications: airline (daufault model) or full automatic reserach.

automdl.enabled	
a logical. If TRUE, the automatic modelling of the ARIMA model is enabled. If FALSE, the parameters of the ARIMA model can be specified.

A word on restrictions; can some setting be mixed, ex user model and different
u roots limits 

Forecast horizon is in X-11..

#### Modifing automatic detection 

Control variables for the automatic modelling of the ARIMA model (when automdl.enabled is set to TRUE):

automdl.acceptdefault	
a logical. If TRUE, the default model (ARIMA(0,1,1)(0,1,1)) may be chosen in the first step of the automatic model identification. If the Ljung-Box Q statistics for the residuals is acceptable, the default model is accepted and no further attempt will be made to identify another model.

automdl.cancel	
the cancelation limit (numeric). If the difference in moduli of an AR and an MA roots (when estimating ARIMA(1,0,1)(1,0,1) models in the second step of the automatic identification of the differencing orders) is smaller than the cancelation limit, the two roots are assumed equal and cancel out.

automdl.ub1	
the first unit root limit (numeric). It is the threshold value for the initial unit root test in the automatic differencing procedure. When one of the roots in the estimation of the ARIMA(2,0,0)(1,0,0) plus mean model, performed in the first step of the automatic model identification procedure, is larger than the first unit root limit in modulus, it is set equal to unity.

automdl.ub2	
the second unit root limit (numeric). When one of the roots in the estimation of the ARIMA(1,0,1)(1,0,1) plus mean model, which is performed in the second step of the automatic model identification procedure, is larger than second unit root limit in modulus, it is checked if there is a common factor in the corresponding AR and MA polynomials of the ARMA model that can be cancelled (see automdl.cancel). If there is no cancellation, the AR root is set equal to unity (i.e. the differencing order changes).

automdl.mixed	
a logical. This variable controls whether ARIMA models with non-seasonal AR and MA terms or seasonal AR and MA terms will be considered in the automatic model identification procedure. If FALSE, a model with AR and MA terms in both the seasonal and non-seasonal parts of the model can be acceptable, provided there are no AR or MA terms in either the seasonal or non-seasonal terms.

automdl.balanced	
a logical. If TRUE, the automatic model identification procedure will have a preference for balanced models (i.e. models for which the order of the combined AR and differencing operator is equal to the order of the combined MA operator).

automdl.armalimit	
the ARMA limit (numeric). It is the threshold value for t-statistics of ARMA coefficients and constant term used for the final test of model parsimony. If the highest order ARMA coefficient has a t-value smaller than this value in magnitude, the order of the model is reduced. If the constant term t-value is smaller than the ARMA limit in magnitude, it is removed from the set of regressors.

automdl.reducecv	
numeric, ReduceCV. The percentage by which the outlier's critical value will be reduced when an identified model is found to have a Ljung-Box statistic with an unacceptable confidence coefficient. The parameter should be between 0 and 1, and will only be active when automatic outlier identification is enabled. The reduced critical value will be set to (1-ReduceCV)*CV, where CV is the original critical value.

automdl.ljungboxlimit	
the Ljung Box limit (numeric). Acceptance criterion for the confidence intervals of the Ljung-Box Q statistic. If the LjungBox Q statistics for the residuals of a final model is greater than the Ljung Box limit, then the model is rejected, the outlier critical value is reduced and model and outlier identification (if specified) is redone with a reduced value.

automdl.ubfinal	
numeric, final unit root limit. The threshold value for the final unit root test. If the magnitude of an AR root for the final model is smaller than the final unit root limit, then a unit root is assumed, the order of the AR polynomial is reduced by one and the appropriate order of the differencing (non-seasonal, seasonal) is increased. The parameter value should be greater than one.


setting in GUI 

image specification window, arima with auto box ticked 


setting in R (see if Tramo specificities)
```{r,eval=FALSE}

# spec_5 <- x13_spec(spec = spec_1, 
# automdl.enabled = NA,
#   automdl.acceptdefault = NA,
#   automdl.cancel = NA_integer_,
#   automdl.ub1 = NA_integer_,
#   automdl.ub2 = NA_integer_,
#   automdl.mixed = NA,
#   automdl.balanced = NA,
#   automdl.armalimit = NA_integer_,
#   automdl.reducecv = NA_integer_,
#   automdl.ljungboxlimit = NA_integer_,
#   automdl.ubfinal = NA_integer_,


```


#### User-defined Arima model

Control variables for the non-automatic modelling of the ARIMA model (when automdl.enabled is set to FALSE):

arima.mu	
logical. If TRUE, the mean is considered as part of the ARIMA model.

arima.p	
numeric. The order of the non-seasonal autoregressive (AR) polynomial.

arima.d	
numeric. The regular differencing order.

arima.q	
numeric. The order of the non-seasonal moving average (MA) polynomial.

arima.bp	
numeric. The order of the seasonal autoregressive (AR) polynomial.

arima.bd	
numeric. The seasonal differencing order.

arima.bq	
numeric. The order of the seasonal moving average (MA) polynomial.

Control variables for the user-defined ARMA coefficients. Coefficients can be defined for the regular and seasonal autoregressive (AR) polynomials and moving average (MA) polynomials. The model considers the coefficients only if the procedure for their estimation (arima.coefType) is provided, and the number of provided coefficients matches the sum of (regular and seasonal) AR and MA orders (p,q,bp,bq).

arima.coefEnabled	
logical. If TRUE, the program uses the user-defined ARMA coefficients.

arima.coef	
a vector providing the coefficients for the regular and seasonal AR and MA polynominals. The vector length must be equal to the sum of the regular and seasonal AR and MA orders. The coefficients shall be provided in the following order: regular AR (Phi; p elements), regular MA (Theta; q elements), seasonal AR (BPhi; bp elements) and seasonal MA (BTheta; bq elements). E.g.: arima.coef=c(0.6,0.7) with arima.p=1, arima.q=0,arima.bp=1 and arima.bq=0.

arima.coefType	
a vector defining the ARMA coefficients estimation procedure. Possible procedures are: "Undefined" = no use of any user-defined input (i.e. coefficients are estimated), "Fixed" = the coefficients are fixed at the value provided by the user, "Initial" = the value defined by the user is used as the initial condition. For orders for which the coefficients shall not be defined, the arima.coef can be set to NA or 0, or the arima.coefType can be set to "Undefined". E.g.: arima.coef = c(-0.8,-0.6,NA), arima.coefType = c("Fixed","Fixed","Undefined").

(for both options)
fcst.horizon	
the forecasting horizon (numeric). The forecast length generated by the RegARIMA model in periods (positive values) or years (negative values). By default, the program generates a two-year forecast (fcst.horizon set to -2).



setting in GUI 

image specification window, arima with auto box not tickec


setting in R (see if Tramo specificities)
```{r,eval=FALSE}

spec_5 <- x13_spec(spec = spec_1, 
automdl.enabled = FALSE,

  arima.mu = NA,
  arima.p = NA_integer_,
  arima.d = NA_integer_,
  arima.q = NA_integer_,
  arima.bp = NA_integer_,
  arima.bd = NA_integer_,
  arima.bq = NA_integer_,
  arima.coefEnabled = NA,
  arima.coef = NA,
  arima.coefType = NA,
  fcst.horizon = NA_integer_,

```






Tramo and Reg-Arima are very similar...details in M chapter, parameters and output are the same, treated as one here

Context : here in put is spcified (auto or user) focus on global model estimation

Quick launch (= automatic run)

Output1: series (if relevant) Retrieve regressors GUI (cruncher) R

Retrieve Pre-adjustment series Table

in GUI (cruncher)

in R

Output2: Final Params what is selected and estimated by the software (not in the specifs above)

arima orders (if relevant) and coefficients

GUI

R

### RegArima model Results and Diagnostics

#### Regression Results and diagnostics 

tables with results for all variables (auto and user-defined) student, F test - tests

#### Arima model results

##### Final parameters 

table with coefficients, student, correlation 

in GUI 
additonnal graphs 

in R
```{r, eval=FALSE}

```


##### Goodness of fit Test on Arima model residuals 

list 

retrieve in GUI 
- main 
- prep proc
main node
datails 
peut etre pas de capture pour tout: pb de volume
la lacture des chapitres doit rester fluide 
appndix, gui chapter ?
- diagnostics node
here just residuals and full residuals (what is the difference)


(global post decomp results explained in QA part)


retireve in R
v2 rjdemetra
(comprehensive inR )


#### Residual Calendar effects

Residual calendar effects what kinf of test is performed ? 
td spectral peaks 
residual effect in $SA$ or $I$ serie

retrieve in GUI 

retrieve in R (v2 and v3)


### Allocation of pre-treatment effects

(in the decomp part for x11 and seats, table with allocation post decomp)

## X-11 Decompostion

this part should allow to use x-11 via R as well as via GUI

### Default specifications

link to table from reg-arima model

if identifiers slightly different in GUI, make it clear + pb of names in V3

in calendar effects : what is tested, link to calendar chapter

typos : RJDemetra doc (pull req)

-   7 TD vars

### Quick Launch

(linked from intro JDemetra+ intro chapter )

### Output 1: series

| Series                    | Final X11 name | Final Results | Reallocation of pre-adjustment effects |
|---------------------------|----------------|---------------|----------------------------------------|
| Raw series (forecasts)    |                | y (y_f)       |                                        |
| Final seasonal component  | D16            | s (s_f)       |                                        |
| Final trend               | D12            | t (t_f)       |                                        |
| Final irregular           | D13            | i (i_f)       |                                        |
| Calendar component        |                |               |                                        |
| Seasonal without calendar | D10            |               |                                        |

make clear reallocation of outliers effects (frequent questions)

reallocation of intervention variables effects

att : diff D10 and D16 ?

X-11 gives access to a great part of it's intermediate computations (link to M chapter)

Here we focus on the final components main series (= 2nd part of D tables, outliers effects added)

List of series (edit : table with name and meaning)

Retrieve in GUI (forecasts glued)

link to chap GUI : generate output in GUI (generic) link to chap cruncher : generate output with cruncher

Retrieve in R (forecast in a specific variable)

Link to appendix: final output overview

### Output 2: final parameters

Relevant if parameters not set manually, or any parameters automatically selected by the software without having a fixed default value. (The rest of the parameters is set in the spec) To manually set hose parameters and see all the fixed default values see Specifications / parameters section

Final trend filter : length of Henderson filter applied for final estimation (in the second part of the D step).

Final seasonal filer: length of Henderson filter applied for final estimation (in the second part of the D step).

Retrieve via GUI image ? Node Decomposition(X11) \> Final Filters (make node clickable, link to GUI chapter, handling of nodes)

Retrieve in R From the model_sa object (link to R package chap global explanation)

```{r, eval=FALSE}

model_sa$decomposition$s_filter
model_sa$decomposition$t_filter

# add version 3 equivalent
```

### Output 3: diagnostics

X11 produces the following type diagnostics or quality measures Table with link to detail - SI ratios

#### SI-ratios

It is a plot (paste example)

Description, and computation details

Retrieve in GUI NODE Main Results \> SI-Ratios

in GUI values cannot be retrieved Retrieve in R

```{r, eval=FALSE}
# data frame with values 
model_sa$decomposition$si_ratio
# customizable plot
plot(model_sa, type= "cal-seas-irr",first_date = c(2015, 1))

# add version 3 equivalent
```

#### M-statistics

At the end of the decomposition, X-11 algorithm provides quality mesures of the decomposition called "M statistics": 11 statistics (M1 to M11) and 2 summary indicators (Q et Q-M2). By design (clickable) $0<M_x<3$ and acceptance region is $M_x \leq 1$ Formula for $Q$ (They are based on F-tables)

-   **M1** The relative contribution of the irregular over three months span
-   **M2** The relative contribution of the irregular component to the stationary portion of the variance
-   **M3** The amount of month to month change in the irregular component as compared to the amount of month to month change in the trend-cycle (I/C-ratio)
-   **M5** MCD (Months for Cyclical Dominance): The number of months it takes the change in the trend-cycle to surpass the amount of change in the irregular
-   **M6** The amount of year to year change in the irregular as compared to the amount of year to year change in the seasonal (only valid for 3x5 seasonal filter)
-   **M7** The amount of moving seasonality present relative to the amount of stable seasonality
-   **M8** The size of the fluctuations in the seasonal component throughout the whole series
-   **M9** The average linear movement in the seasonal component throughout the whole series
-   **M10** Same as 8, calculated for recent years only (4 years, N-2 to N-5)
-   **M11** Same as 9, calculated for recent years only

For futher details link to Lothian-Mory (quid in M_meth X11)

Retrieve in GUI NODE Decompostion(X-11) \> Quality Measures \> Summary

Retrieve in R

```{r, eval=FALSE}

model_sa$decomposition$mstats
# add version 3 equivalent
```

#### Detailed Quality measures

List (+ link to chap M: add descp from Lothian Mory/ current doc) make clear: on whic x11 series is the measure based

in GUI all the diagnostics below can be retrieved in NODE Decomposition(X-11) \> Quality Measures \> Details

If a stat can be retrievedin R, the code example is in the corresponding paragraph, otherwise it is not possible

##### Average differences without regard to sign over the indicated span

##### Relative contribution to the variance of the differences in the components of the original series

##### Average differences with regard to sign and standard deviation over indicated span

##### Average duration of run

##### I/C ratio over indicated span

##### I/C ratio (global)

##### Relative contribution to the stationnary part of the variance in the original series

##### Autocorrelations in the irregular

##### Heteroskedasticity

Cochran test on equal variances within each period

##### Moving seasonality ratios (MSR)

### User-defined parameters

Here is described how to change default values or automatic choices.

##### General settings

-   **Mode**
    -   check if this option still works, if so add and edit instructions from old page)
    -   if not but button present : explain that the mode is determined in pre-adjustment (function)
-   **Seasonal component**
    -   check if still relevant, idem as above
    -   in v.2.3 if not ticked, S estimated but options on seasonal filter not available
-   **Forecasts horizon**

Length of the forecasts generated by the RegARIMA model - in months (positive values) - years (negative values) - if set to is set to 0, the X-11 procedure does not use any model-based forecasts but the original X-11 type forecasts for one year. - default value: -1, thus one year from the Arima model

-   **Backcasts horizon**

Length of the backcasts generated by the RegARIMA model - in months (positive values) - years (negative values) - default value: 0

##### Irregular correction

-   **LSigma**

    -   sets lower sigma (standard deviation) limit used to down-weight the extreme irregular values in the internal seasonal adjustment iterations, learn more here (LINK to M\_ chapter)
    -   values in $[0,Usigma]$
    -   default value is 1.5

-   **USigma**

    -   sets upper sigma (standard deviation)
    -   values in $[Lsigma,+\infty]$
    -   default value is 2.5

-   **Calendarsigma**

    -   allows to set different **LSigma** and **USigma** for each period
    -   values
        -   None (default)
        -   All: standard errors used for the extreme values detection and adjustment computed separately for each calendar month/quarter
        -   Signif: groups determined by cochran test (check)
        -   Sigmavec: set two customized groups of periods

-   **Excludeforecasts**

    -   ticked : forecasts and backcasts from the RegARIMA model not used in Irregular Correction
    -   unticked (default): forecasts and backcasts used

##### Seasonality extraction filters choice

Specifies which be used to estimate the seasonal factors for the entire series (link to relevant part in M chapter):

-   **Seasonal filter**

-   default value: *MSR* (Moving seasonality ratio), automatic choice of final seasonal filter (cf msr defintion and decison table: link ), initial filters are computed with $3\times 3$

-   choices : $3\times 1$, $3\times 3$, $3\times 5$, $3\times 9$, $3\times 15$ or Stable

-   "Stable" : constat factor for each calendar period (simple moving average of all $S+I$ values for each period)

User choices will be applied to all steps or only to final phase D step.

The seasonal filters can be selected for the entire series, or for a particular month or quarter.

-   **Details on seasonal filters**

Sets different seasonal filters by period in order to account for seasonal heteroskedasticity (link to M chapter)

-   default value: empty

##### Trend estimation filters

-   **Automatic Henderson filter** our user-defined

    -   default: length 13
    -   unticked: user defined length choice

-   **Henderson filter** length choice

    -   values: odd number in $[3,101]$
    -   default value: 13

Check: will user choice be applied to all steps or only to final phase D step

#### Parameter setting in GUI

Specification (general or particular to one series) image

All the parameters above can be set with the specification (link to general explanations) box

#### Parameter setting in R packages

extensive help on functions available in package help pages Rcode snippets

In R, to implement any param change, it is required to retrieve current spec, modify it and apply it again (see T R packages chapter for details). (specific link)

here example changing all the settings (just remove irrelevant changes)

Rjdemetra (v2) Edit : here static R code link to a "worked example" wih dynamic code ticked box in GUI corresponds to ...? in R

```{r eval=FALSE}
#Creating a modified specification, customizing all available X11 parameters
modified_spec<- x13_spec(current_sa_model,
    #x11.mode="?",
    #x11.seasonalComp = "?",
    x11.fcasts = -2,
    x11.bcasts = -1,
    x11.lsigma = 1.2,
    x11.usigma = 2.8,
    x11.calendarSigma = NA, # EDIT with example
      x11.sigmaVector = NA,
    x11.excludeFcasts = NA
    # filters 
    x11.trendAuto = NA, # needed inf value ?
    x11.trendma = 23,
    x11.seasonalma = "S3X9
    # details on seasonal filters ?)

#New SA estimation : apply modified_spec
modified_sa_model<-x13(raw_series,modified_spec)

```

EDIT : link to package help page v2 +v3

## SEATS Decomposition

policy: what is readable in GUI should be explained (even if shortly with link to details here) intermediate series ?

decomp of lineraized series in level or log

### Default specifications

link to Tramo-Seats part

if identifiers slightly different in GUI, make it clear + pb of names in V3

in calendar effects : what is tested, link to calendar chapter

typos : RJDemetra doc (pull req)

-   7 TD vars

### Quick Launch

overall procedure

in GUI

in R

### Output 1: series

global indications: \_f: forecasts - \_e - -ef

#### Stochastic series

decompostion of the linearisezed series or of its log if multiplicative model

components: t_lin, s_lin, i_lin

if log, everything is dispalayed in log

| Series Name             | Meaning |
|-------------------------|---------|
| decomposition.y_lin     |         |
| decomposition.y_lin_f   |         |
| decomposition.y_lin_ef  |         |
| decomposition.t_lin     |         |
| decomposition.t_lin_f   |         |
| decomposition.t_lin_e   |         |
| decomposition.t_lin_f   |         |
| decomposition.sa_lin    |         |
| decomposition.sa_lin_f  |         |
| decomposition.sa_lin_e  |         |
| decomposition.sa_lin_ef |         |
| decomposition.s_lin     |         |
| decomposition.s_lin_f   |         |
| decomposition.s_lin_e   |         |
| decomposition.s_lin_ef  |         |
| decomposition.i_lin     |         |
| decomposition.i_lin_f   |         |
| decomposition.i_lin_e   |         |
| decomposition.i_lin_ef  |         |

Retrieve in GUI

NODE : Decompostion \> Stocastic series

forecast f series are pasted at the end of the correspoding series

-   \_e series are labelled with (stde)

\_ef appear in graphs (but values cannot be retrieved)

IMAGE1 GUI

-   image 1 : decompostion node and series

-   image 2 trend graph

-   image 3 seasonal graph

Retrieve in R

#### Components (Level)

if additive model : same as

decompostion of the linearisezed series or of its log if multiplicative model

components: t_lin, s_lin, i_lin

if log, everything is dispalayed in log

| Series Name             | Meaning |
|-------------------------|---------|
| decomposition.y_lin     |         |
| decomposition.y_lin_f   |         |
| decomposition.y_lin_ef  |         |
| decomposition.t_lin     |         |
| decomposition.t_lin_f   |         |
| decomposition.t_lin_e   |         |
| decomposition.t_lin_f   |         |
| decomposition.sa_lin    |         |
| decomposition.sa_lin_f  |         |
| decomposition.sa_lin_e  |         |
| decomposition.sa_lin_ef |         |
| decomposition.s_lin     |         |
| decomposition.s_lin_f   |         |
| decomposition.s_lin_e   |         |
| decomposition.s_lin_ef  |         |
| decomposition.i_lin     |         |
| decomposition.i_lin_f   |         |
| decomposition.i_lin_e   |         |
| decomposition.i_lin_ef  |         |

Retrieve in GUI

NODE : Decompostion \> Stocastic series

forecast f series are pasted at the end of the correspoding series

-   \_e series are labelled with (stde)

\_ef appear in graphs (but values cannot be retrieved)

IMAGE1 GUI

-   image 1 : decompostion node and series

-   image 2 trend graph

-   image 3 seasonal graph

Retrieve in R

Biais correction voir JP (done between lin and and comp ?)

#### Final series

decompostion of the linearisezed series or of its log if multiplicative model

components: t_lin, s_lin, i_lin

if log, everything is dispalayed in log

| Series Name             | Meaning |
|-------------------------|---------|
| decomposition.y_lin     |         |
| decomposition.y_lin_f   |         |
| decomposition.y_lin_ef  |         |
| decomposition.t_lin     |         |
| decomposition.t_lin_f   |         |
| decomposition.t_lin_e   |         |
| decomposition.t_lin_f   |         |
| decomposition.sa_lin    |         |
| decomposition.sa_lin_f  |         |
| decomposition.sa_lin_e  |         |
| decomposition.sa_lin_ef |         |
| decomposition.s_lin     |         |
| decomposition.s_lin_f   |         |
| decomposition.s_lin_e   |         |
| decomposition.s_lin_ef  |         |
| decomposition.i_lin     |         |
| decomposition.i_lin_f   |         |
| decomposition.i_lin_e   |         |
| decomposition.i_lin_ef  |         |

Retrieve in GUI

NODE : Decompostion \> Stocastic series

forecast f series are pasted at the end of the corresponding series

-   \_e series are labelled with (stde)

\_ef appear in graphs (but values cannot be retrieved)

IMAGE1 GUI

-   image 1 : decompostion node and series

-   image 2 trend graph

-   image 3 seasonal graph

Retrieve in R

make clear reallocation of outliers effects (frequent questions)

Table

GUI

R

### Output2: Final Params

what is chosen automatically or default (cf estp) Relevant if parameters not set manually, or any parameters automatically selected by the software without having a fixed default value. (The rest of the parameters is set in the spec) To manually set hose parameters and see all the fixed default values see Specifications / parameters section

here all have a default value, nothing to be automatically selected

### Output3: Diagnostics

SEATS (model based) specific diagnostics check GUI (more plots, values) vs R links to methods chapter, here just be able to "read" (knowledge assumed) (here direct base on gui plots, and the add what can be retrieved in R, if cannot be retrieved in R : could it be rebuild from available elements) Obj : simple description res : current doc, jpslides, doc esp, Q JP

-   WK analysis

components final estimators

-   Error analysis autocorrelation of the errors (sa, trend) revisons of the errors

-   Growth rates

-   Model based tests

-   Significant seasonality

-   Stationnary variance decompostion

### Fine-tuning : user defined parameters

-   Prediction length

Forecast span used in the decomposition default: one year (-1) (years are set in negative values, positive values indicate nimber of periods)

-   Approximation Mode

Modification type for inadmissible models None (default) Legacy Noisy

-   MA unit root boundary

Modulus threshold for resetteing MA "near-unit" roots \[0,1\] default (0.95)

-   Trend Boundary Modulus thershold for assingning positive real AR Roots \[0,1\] default (0.5)

-   Seasonal Tolerance Degree threshold for assigning complex AR roots \[0,10\] default (2)

-   Seasonal Boundary (unique) Modulus threshold for assigning negative real AR roots \[0,1\] default (0.8)

-   Seasonal Boundary (unique) Same modulus threshold unique seasonal AR roots \[0,1\] default (0.8)

-   Method

Algorithm used for estimation of unobserved componements

Burman (default)

KalmanSmoother

McEllroyMatrix

Further explanation (cf slides JP)

link to M chapter for details on root allocation

##### Set in GUI

In specification window (link to GUI global exp)

IMAGE

##### Set in R

version 2 (RJDemetra)

```{r, eval=FALSE}
tramoseats_spec(
 spec = c("RSAfull", "RSA0", "RSA1", "RSA2", "RSA3", "RSA4", "RSA5"),
  fcst.horizon = NA_integer_,
  seats.predictionLength = NA_integer_,
  seats.approx = c(NA, "None", "Legacy", "Noisy"),
  seats.trendBoundary = NA_integer_,
  seats.seasdBoundary = NA_integer_,
  seats.seasdBoundary1 = NA_integer_,
  seats.seasTol = NA_integer_,
  seats.maBoundary = NA_integer_,
  seats.method = c(NA, "Burman", "KalmanSmoother", "McElroyMatrix")
)

```

in version 3 with {rjd3tramoseats}

## Quality assessment for X13-Arima and Tramo-Seats

(add at begininng of chapter ? X13 an d TS as historical and more popular, ghave more built-in available features, like predifined quality assessment)

(all GUI based analysis) NODES below bechmarking

### Matrix
comparaing all predefined specs 
available only in a formatted state in GUI 
(in R has to be generated by the user

### Residual seasonality

list (chat is available)

visu in GUI (can be larger than what is pre-defined in R)

### Residual calendar effects




### Add other diagnostics node


## STL

use on linearized data data, no pre-adjustment (2nd layer)

## SSF

(2nd layer)
